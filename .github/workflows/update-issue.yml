name: Update issue
on:
  issues:
    types:
      - opened
      - reopened
      - edited
permissions:
  issues: write
env: 
 body: ${{ github.event.issue.body }}
jobs:
  Main:
   runs-on: ubuntu-latest 
   steps:
    - name: bruh
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'
    - uses: jannekem/run-python-script-action@v1
      name: run PY script
      with:
        script: |
          import os
          import base64
          print("env body: " + os.environ["body"])
          new_body = os.environ["body"]
          new_body = new_body.replace("### [mod]", "[mod]")
          set_env("body", base64.b64encode(bytes(new_body, 'utf-8')))
    - uses: akiojin/decode-base64-github-action@v0.1.0
      id: decode-base64
      with:
        base64: ${{ env.body }}
    - name: Fix body
      run: |
        x="http%3A%2F%2Fstackoverflow.com%2Fsearch%3Fq%3Durldecode%2Bbash"
        y=$(urldecode "$x")
        function urldecode() { : "${*//+/ }"; echo -e "${_//%/\\x}"; }
        gh issue edit "${{ github.event.issue.number }}" --body "${{ steps.decode-base64.outputs.decoded }}"
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GH_REPO: ${{ github.repository }}
    - name: Remove in-process label
      if: contains(github.event.issue.labels.*.name, 'in-process')
      run: gh issue edit "${{ github.event.issue.number }}" --remove-label in-process
      env:
        GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GH_REPO: ${{ github.repository }}
